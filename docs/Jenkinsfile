#!groovy
@Library('jenkins-pipeline-lib') _

pipeline
{
  agent any
  stages
  {
    stage('Setup')
    {
      steps
      {
        sh 'make clean'
      }
    }
    stage('Build')
    {
      steps
      {
        sh 'make'
      }
    }
    stage('Archive')
    {
      steps
      {
        echo 'Archiving artifacts'
        archiveArtifacts 'buildresults/**/*'
      }
      post
      {
        failure
        {
          sendNotifications 'ARCHIVE_ERROR'
        }
      }
    }
  }
  post
  {
    always
    {
      sendNotifications(currentBuild.result,currentBuild.changeSets)
    }
  }
}
